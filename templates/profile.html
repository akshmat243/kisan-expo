{% extends 'base.html' %}
{% load static %}
{% block content %}
    <style>
        .transition-all {
            transition: all 0.3s ease;
        }
        .profile-photo-container {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        .profile-photo-hover {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        .profile-photo-container:hover .profile-photo-hover {
            transform: translateY(0);
        }
        .edit-icon {
            position: absolute;
            top: 0;
            right: 0;
            background: white;
            border-radius: 50%;
            padding: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            transform: scale(0);
            transition: transform 0.2s ease;
        }
        .edit-able:hover .edit-icon {
            transform: scale(1);
        }
    </style>

    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <!-- Profile Header -->
            <div class="relative">
                <video autoplay loop muted playsinline class="w-full h-48 object-cover">
                    <source src="{% static 'background.mp4' %}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2">
                    <form method="POST" enctype="multipart/form-data" id="photoForm" action="{% url 'profile' %}">
                        {% csrf_token %}
                        <div class="profile-photo-container w-32 h-32 rounded-full border-4 border-white shadow-md overflow-hidden relative">
                            <label for="photoInput">
                                <img src="{{ profile.image.url|default:'https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg' }}"
                                    alt="Profile Photo"
                                    class="w-full h-full object-cover cursor-pointer">
                                <div class="profile-photo-hover text-center py-2 text-sm absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white">
                                    Change Photo
                                </div>
                            </label>
                            <input type="text" name="full_name" value="{{ profile.user.full_name }}" class="hidden">
                            <input type="email" name="email" value="{{ profile.user.email }}" class="hidden">
                            <input id="photoInput" type="file" name="image" accept="image/*" class="hidden" onchange="document.getElementById('photoForm').submit();">
                        </div>
                    </form>

                </div>
                <div class="absolute right-4 top-4">
                    <button id="toggleEdit" class="bg-white text-indigo-600 px-4 py-2 rounded-full shadow-md hover:bg-indigo-50 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        Edit Profile
                    </button>
                </div>
            </div>

            <!-- Profile Content -->
            <div class="px-8 pt-16 pb-8">
                <div class="view-mode">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl font-bold text-gray-800">{{ profile.user.full_name|default:profile.user.email }}</h1>
                        <p class="text-gray-500 mt-1">{{ profile.bio }}</p>
                        <div class="flex justify-center space-x-2 mt-3">
                            <div class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">{{profile.country|default:'India'}}</div>
                            <div class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">Member since {{ profile.created_at|date:"Y" }}</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-6">
                        <div class="bg-gray-50 p-6 rounded-xl edit-able">
                            <div class="flex justify-between items-start">
                                <h2 class="text-lg font-semibold text-gray-800">Personal Information</h2>
                                <div class="edit-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4 space-y-2 text-gray-700">
                                <p><span class="font-medium">Full Name:</span> {{ profile.user.full_name|default:profile.user.email }}</p>
                                <p><span class="font-medium">Age:</span> {{profile.age}}</p>
                                <p><span class="font-medium">Gender:</span> {{profile.gender|default:'Other'}}</p>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-6 rounded-xl edit-able">
                            <div class="flex justify-between items-start">
                                <h2 class="text-lg font-semibold text-gray-800">Contact Details</h2>
                                <div class="edit-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4 space-y-2 text-gray-700">
                                <p><span class="font-medium">Email:</span> {{profile.user.email}}</p>
                                <p><span class="font-medium">Phone:</span> {{profile.mobile}}</p>
                                <p><span class="font-medium">Address:</span> {{profile.address}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 text-gray-500 text-center">
                        <p>Last updated: {{ profile.updated_at|date:"F j, Y" }} at {{ profile.updated_at|date:"g:i A" }}</p>
                    </div>
                </div>
                <!-- Edit Form (hidden by default) -->
                <div class="edit-mode hidden">
                    <form id="profileEditForm" method="post" class="space-y-6">
                        {% csrf_token %}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Personal Information -->
                            <div class="space-y-4">
                                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2">Personal Information</h2>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                    <input type="text" name="full_name" value="{{ form.full_name.value|default_if_none:'' }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth</label>
                                    <input type="date" name="dob" value="{{ form.dob.value|default_if_none:'' }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                                    <select name="gender" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="">Select</option>
                                        <option value="male" {% if form.gender.value == 'male' %}selected{% endif %}>Male</option>
                                        <option value="female" {% if form.gender.value == 'female' %}selected{% endif %}>Female</option>
                                        <option value="other" {% if form.gender.value == 'other' %}selected{% endif %}>Other</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Contact Details -->
                            <div class="space-y-4">
                                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2">Contact Details</h2>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                    <input type="email" name="email" value="{{ form.email.value|default_if_none:'' }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Mobile</label>
                                    <input type="tel" name="mobile" value="{{ form.mobile.value|default_if_none:'' }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                                    <textarea name="address" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">{{ form.address.value|default_if_none:'' }}</textarea>
                                </div>
                            </div>

                            <!-- Overview -->
                            <div class="space-y-4">
                                <h2 class="text-xl font-semibold text-gray-800 border-b pb-2">Overview</h2>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Bio</label>
                                    <textarea name="bio" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">{{ form.bio.value|default_if_none:'' }}</textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                                    <input type="text" name="country" value="{{ form.country.value|default_if_none:'' }}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end space-x-4 pt-6">
                            <button type="button" id="cancelEdit" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all">
                                Cancel
                            </button>
                            <button type="submit" id="saveChanges" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all">
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Open edit/view profile -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toggleEditBtn = document.getElementById('toggleEdit');
            const cancelEditBtn = document.getElementById('cancelEdit');
            const saveChangesBtn = document.getElementById('saveChanges');
            const viewMode = document.querySelector('.view-mode');
            const editMode = document.querySelector('.edit-mode');

            toggleEditBtn.addEventListener('click', function () {
                const isEditing = !editMode.classList.contains('hidden');

                if (isEditing) {
                    editMode.classList.add('hidden');
                    viewMode.classList.remove('hidden');
                    toggleEditBtn.textContent = 'Edit Profile';
                    toggleEditBtn.classList.remove('bg-indigo-100', 'text-indigo-700');
                    toggleEditBtn.classList.add('bg-white', 'text-indigo-600');
                } else {
                    viewMode.classList.add('hidden');
                    editMode.classList.remove('hidden');
                    toggleEditBtn.textContent = 'View Profile';
                    toggleEditBtn.classList.remove('bg-white', 'text-indigo-600');
                    toggleEditBtn.classList.add('bg-indigo-100', 'text-indigo-700');
                }
            });

            cancelEditBtn.addEventListener('click', function() {
                viewMode.classList.remove('hidden');
                editMode.classList.add('hidden');
                toggleEditBtn.textContent = 'Edit Profile';
                toggleEditBtn.classList.add('bg-white', 'text-indigo-600');
                toggleEditBtn.classList.remove('bg-indigo-100', 'text-indigo-700');
            });

            saveChangesBtn.addEventListener('click', function() {
                viewMode.classList.remove('hidden');
                editMode.classList.add('hidden');
                toggleEditBtn.textContent = 'Edit Profile';
                toggleEditBtn.classList.add('bg-white', 'text-indigo-600');
                toggleEditBtn.classList.remove('bg-indigo-100', 'text-indigo-700');
            });

            document.querySelectorAll('.edit-able').forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.classList.add('ring-1', 'ring-indigo-500');
                });
                item.addEventListener('mouseleave', function() {
                    this.classList.remove('ring-1', 'ring-indigo-500');
                });
            });
        });
        const rawDate = new Date("2023-01-15T14:45:00");
        const options = { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: 'numeric',
        minute: '2-digit',
        hour12: true 
        };

        const formatted = "Last updated: " + rawDate.toLocaleString('en-US', options);
        console.log(formatted);
        // Last updated: January 15, 2023 at 2:45 PM
    </script>



{% endblock %}

