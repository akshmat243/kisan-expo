{% load static %}
{% load custom_filters %}
{% has_perm request.user 'User' 'r' as can_read_user %}
{% has_perm request.user 'Role' 'r' as can_read_role %}
{% has_perm request.user 'PermissionType' 'r' as can_read_permission %}
{% has_perm request.user 'AuditLog' 'r' as can_read_logs %}
<!-- Role -->
{% has_perm request.user 'Role' 'c' as can_create_role %}
{% has_perm request.user 'Role' 'd' as can_delete_role %}
{% has_perm request.user 'Role' 'u' as can_update_role %}
{% has_perm request.user 'RoleModelPermission' 'r' as can_read_roles %}
{% has_perm request.user 'RoleModelPermission' 'c' as can_create_roles %}
<!-- User -->
{% has_perm request.user 'User' 'c' as can_create_user %}
{% has_perm request.user 'User' 'd' as can_delete_user %}
{% has_perm request.user 'User' 'u' as can_update_user %}
{% has_perm request.user 'User' 'u' as can_password_change_user %}
<!-- Permission -->
{% has_perm request.user 'PermissionType' 'c' as can_create_permission %}
{% has_perm request.user 'PermissionType' 'd' as can_delete_permission %}
{% has_perm request.user 'PermissionType' 'u' as can_update_permission %}
<!-- Audit Logs -->
{% has_perm request.user 'AuditLog' 'd' as can_delete_log %}
<!-- Notification -->
{% has_perm request.user 'Notification' 'r' as can_read_notification %}
<!-- Profile -->
{% has_perm request.user 'Profile' 'u' as can_update_profile %}
<!-- Warehouse -->
{% has_perm request.user 'Warehouse' 'r' as can_read_warehouse %}
{% has_perm request.user 'Warehouse' 'c' as can_create_warehouse %}
{% has_perm request.user 'Warehouse' 'u' as can_update_warehouse %}
{% has_perm request.user 'Warehouse' 'd' as can_delete_warehouse %}
<!-- Inventory -->
{% has_perm request.user 'Inventory' 'r' as can_read_inventory %}
{% has_perm request.user 'Inventory' 'c' as can_create_inventory %}
{% has_perm request.user 'Inventory' 'u' as can_update_inventory %}
{% has_perm request.user 'Inventory' 'd' as can_delete_inventory %}
<!-- ECommerce Read -->
{% has_perm request.user 'Category' 'r' as can_read_category %}
{% has_perm request.user 'Brand' 'r' as can_read_brand %}
{% has_perm request.user 'Product' 'r' as can_read_product %}
{% has_perm request.user 'ProductImage' 'r' as can_read_productimage %}
{% has_perm request.user 'ProductReview' 'r' as can_read_productreview %}
{% has_perm request.user 'Cart' 'r' as can_read_cart %}
{% has_perm request.user 'CartItem' 'r' as can_read_cartitem %}
{% has_perm request.user 'Coupon' 'r' as can_read_coupon %}
{% has_perm request.user 'Order' 'r' as can_read_order %}
{% has_perm request.user 'OrderItem' 'r' as can_read_orderitem %}
{% has_perm request.user 'Payment' 'r' as can_read_payment %}
<!-- Create -->
{% has_perm request.user 'Category' 'c' as can_create_category %}
{% has_perm request.user 'Brand' 'c' as can_create_brand %}
{% has_perm request.user 'Product' 'c' as can_create_product %}
{% has_perm request.user 'ProductImage' 'c' as can_create_productimage %}
{% has_perm request.user 'ProductReview' 'c' as can_create_productreview %}
{% has_perm request.user 'Cart' 'c' as can_create_cart %}
{% has_perm request.user 'CartItem' 'c' as can_create_cartitem %}
{% has_perm request.user 'Coupon' 'c' as can_create_coupon %}
{% has_perm request.user 'Order' 'c' as can_create_order %}
{% has_perm request.user 'OrderItem' 'c' as can_create_orderitem %}
{% has_perm request.user 'Payment' 'c' as can_create_payment %}
<!-- Update -->
{% has_perm request.user 'Category' 'u' as can_update_category %}
{% has_perm request.user 'Brand' 'u' as can_update_brand %}
{% has_perm request.user 'Product' 'u' as can_update_product %}
{% has_perm request.user 'ProductImage' 'u' as can_update_productimage %}
{% has_perm request.user 'ProductReview' 'u' as can_update_productreview %}
{% has_perm request.user 'Cart' 'u' as can_update_cart %}
{% has_perm request.user 'CartItem' 'u' as can_update_cartitem %}
{% has_perm request.user 'Coupon' 'u' as can_update_coupon %}
{% has_perm request.user 'Order' 'u' as can_update_order %}
{% has_perm request.user 'OrderItem' 'u' as can_update_orderitem %}
{% has_perm request.user 'Payment' 'u' as can_update_payment %}
<!-- Delete -->
{% has_perm request.user 'Category' 'd' as can_delete_category %}
{% has_perm request.user 'Brand' 'd' as can_delete_brand %}
{% has_perm request.user 'Product' 'd' as can_delete_product %}
{% has_perm request.user 'ProductImage' 'd' as can_delete_productimage %}
{% has_perm request.user 'ProductReview' 'd' as can_delete_productreview %}
{% has_perm request.user 'Cart' 'd' as can_delete_cart %}
{% has_perm request.user 'CartItem' 'd' as can_delete_cartitem %}
{% has_perm request.user 'Coupon' 'd' as can_delete_coupon %}
{% has_perm request.user 'Order' 'd' as can_delete_order %}
{% has_perm request.user 'OrderItem' 'd' as can_delete_orderitem %}
{% has_perm request.user 'Payment' 'd' as can_delete_payment %}
<!-- CRM Account -->
{% has_perm request.user 'Account' 'r' as can_read_account %}
{% has_perm request.user 'Account' 'c' as can_create_account %}
{% has_perm request.user 'Account' 'u' as can_update_account %}
{% has_perm request.user 'Account' 'd' as can_delete_account %}
<!-- CRM Contact -->
{% has_perm request.user 'Contact' 'r' as can_read_contact %}
{% has_perm request.user 'Contact' 'c' as can_create_contact %}
{% has_perm request.user 'Contact' 'u' as can_update_contact %}
{% has_perm request.user 'Contact' 'd' as can_delete_contact %}
<!-- CRM Lead -->
{% has_perm request.user 'Lead' 'r' as can_read_lead %}
{% has_perm request.user 'Lead' 'c' as can_create_lead %}
{% has_perm request.user 'Lead' 'u' as can_update_lead %}
{% has_perm request.user 'Lead' 'd' as can_delete_lead %}
<!-- CRM Opportunity -->
{% has_perm request.user 'Opportunity' 'r' as can_read_opportunity %}
{% has_perm request.user 'Opportunity' 'c' as can_create_opportunity %}
{% has_perm request.user 'Opportunity' 'u' as can_update_opportunity %}
{% has_perm request.user 'Opportunity' 'd' as can_delete_opportunity %}
<!-- CRM Activity -->
{% has_perm request.user 'Activity' 'r' as can_read_activity %}
{% has_perm request.user 'Activity' 'c' as can_create_activity %}
{% has_perm request.user 'Activity' 'u' as can_update_activity %}
{% has_perm request.user 'Activity' 'd' as can_delete_activity %}
<!-- CRM OpportunityNote -->
{% has_perm request.user 'OpportunityNote' 'r' as can_read_opportunitynote %}
{% has_perm request.user 'OpportunityNote' 'c' as can_create_opportunitynote %}
{% has_perm request.user 'OpportunityNote' 'u' as can_update_opportunitynote %}
{% has_perm request.user 'OpportunityNote' 'd' as can_delete_opportunitynote %}
<!-- CRM Document -->
{% has_perm request.user 'Document' 'r' as can_read_document %}
{% has_perm request.user 'Document' 'c' as can_create_document %}
{% has_perm request.user 'Document' 'u' as can_update_document %}
{% has_perm request.user 'Document' 'd' as can_delete_document %}
<!-- Inventory StockTransaction -->
{% has_perm request.user 'StockTransaction' 'r' as can_read_stocktransaction %}
{% has_perm request.user 'StockTransaction' 'c' as can_create_stocktransaction %}
{% has_perm request.user 'StockTransaction' 'u' as can_update_stocktransaction %}
{% has_perm request.user 'StockTransaction' 'd' as can_delete_stocktransaction %}
<!-- Inventory StockTransaction -->
{% has_perm request.user 'StockTransfer' 'r' as can_read_stocktransfer %}
{% has_perm request.user 'StockTransfer' 'c' as can_create_stocktransfer %}
{% has_perm request.user 'StockTransfer' 'u' as can_update_stocktransfer %}
{% has_perm request.user 'StockTransfer' 'd' as can_delete_stocktransfer %}
<!-- CMS Page -->
{% has_perm request.user 'Page' 'r' as can_read_page %}
{% has_perm request.user 'Page' 'c' as can_create_page %}
{% has_perm request.user 'Page' 'u' as can_update_page %}
{% has_perm request.user 'Page' 'd' as can_delete_page %}
<!-- CMS Read -->
{% has_perm request.user 'Section' 'r' as can_read_section %}
{% has_perm request.user 'Image' 'r' as can_read_image %}
{% has_perm request.user 'Video' 'r' as can_read_video %}
{% has_perm request.user 'FAQ' 'r' as can_read_faq %}
{% has_perm request.user 'Banner' 'r' as can_read_banner %}
{% has_perm request.user 'Testimonial' 'r' as can_read_testimonial %}
{% has_perm request.user 'MetaTag' 'r' as can_read_metatag %}
<!-- CMS Create -->
{% has_perm request.user 'Section' 'c' as can_create_section %}
{% has_perm request.user 'Image' 'c' as can_create_image %}
{% has_perm request.user 'Video' 'c' as can_create_video %}
{% has_perm request.user 'FAQ' 'c' as can_create_faq %}
{% has_perm request.user 'Banner' 'c' as can_create_banner %}
{% has_perm request.user 'Testimonial' 'c' as can_create_testimonial %}
{% has_perm request.user 'MetaTag' 'c' as can_create_metatag %}
<!-- CMS Update -->
{% has_perm request.user 'Section' 'u' as can_update_section %}
{% has_perm request.user 'Image' 'u' as can_update_image %}
{% has_perm request.user 'Video' 'u' as can_update_video %}
{% has_perm request.user 'FAQ' 'u' as can_update_faq %}
{% has_perm request.user 'Banner' 'u' as can_update_banner %}
{% has_perm request.user 'Testimonial' 'u' as can_update_testimonial %}
{% has_perm request.user 'MetaTag' 'u' as can_update_metatag %}
<!-- CMS Delete -->
{% has_perm request.user 'Section' 'd' as can_delete_section %}
{% has_perm request.user 'Image' 'd' as can_delete_image %}
{% has_perm request.user 'Video' 'd' as can_delete_video %}
{% has_perm request.user 'FAQ' 'd' as can_delete_faq %}
{% has_perm request.user 'Banner' 'd' as can_delete_banner %}
{% has_perm request.user 'Testimonial' 'd' as can_delete_testimonial %}
{% has_perm request.user 'MetaTag' 'd' as can_delete_metatag %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kisan Expo</title>
    <link rel="icon" type="image/png" href="{% static 'logo.png' %}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #10b981;
            --dark: #1e293b;
            --light: #f8fafc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f3f4f6;
        }

        /* Sidebar styles */
        .sidebar {
            width: 280px;
            min-height: 100vh;
            background: white;
            box-shadow: 4px 0 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: fixed;
            z-index: 10;
        }

        .sidebar-collapsed {
            width: 80px;
        }

        .sidebar-collapsed .sidebar-text {
            display: none;
        }

        .sidebar-collapsed .logo-text {
            display: none;
        }

        .sidebar-item {
            position: relative;
            transition: all 0.3s ease;
            padding-left: 1.5rem;
        }

        .sidebar-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }

        .sidebar-item:hover::before {
            width: 4px;
        }

        .sidebar-item:hover {
            background-color: #f5f3ff;
        }

        .sidebar-item.active {
            background-color: #eef2ff;
        }

        .sidebar-item.active::before {
            width: 4px;
        }

        .sidebar-item.active .sidebar-icon {
            color: var(--primary);
        }

        /* Main content area */
        .main-content {
            margin-left: 280px;
            transition: all 0.3s ease;
        }

        .main-content-expand {
            margin-left: 80px;
        }

        /* Header styles */
        .header {
            height: 70px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        /* Profile dropdown */
        .profile-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            border-radius: 0.5rem;
            min-width: 200px;
            z-index: 20;
        }

        .profile-toggle:focus-within .profile-menu,
        .profile-toggle:hover .profile-menu {
            display: block;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 30;
            }

            .sidebar-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .main-content-expand {
                margin-left: 0;
            }

            .sidebar-collapsed {
                width: 280px;
            }

            .sidebar-collapsed .sidebar-text,
            .sidebar-collapsed .logo-text {
                display: inline;
            }
        }

        /* Circle animation */
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 20px;
            height: 20px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        /* Hamburger animation */
        .hamburger div {
            width: 24px;
            height: 2px;
            background-color: var(--dark);
            margin: 5px 0;
            transition: all 0.3s ease;
        }

        .hamburger-active div:first-child {
            transform: translateY(7px) rotate(45deg);
        }

        .hamburger-active div:nth-child(2) {
            opacity: 0;
        }

        .hamburger-active div:last-child {
            transform: translateY(-7px) rotate(-45deg);
        }
        .notification-badge {
            @apply bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full absolute -top-1 -right-1;
       }
       /* Tailwind-compatible custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
        }

        .custom-scrollbar:hover::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.4);
        }

    </style>
</head>
<body class="bg-green-100">
    <!-- Sidebar -->
    <aside x-data="{ sidebarCollapsed: false }" class="sidebar bg-green-50 transition-all duration-300"
       :class="sidebarCollapsed ? 'w-26' : 'w-69'" id="sidebar">
        <div class="p-4 flex items-center justify-between border-b bg-green-200">
            <div class="flex items-center">
                <img src="{% static 'logo.png' %}" alt="Kisan Expo Logo" class="w-8 h-8">
                <span class="logo-text text-2xl font-bold ml-2 text-gray-800">𝑲𝒊𝒔𝒂𝒏 𝑬𝒙𝒑𝒐</span>
            </div>
            <button id="toggle-sidebar" @click="sidebarCollapsed = !sidebarCollapsed" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                <i class="fas" :class="sidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
            </button>
        </div>
        
        <div class="p-4 overflow-y-auto h-[calc(100vh-64px)] custom-scrollbar">
            <ul class="space-y-1">
                <li>
                    <a href="{% url 'dashboard' %}" class="sidebar-item flex items-center py-3 px-4 rounded-lg text-gray-600
                    {% if request.resolver_match.url_name == 'dashboard' %}
                    active shadow-lg
                    {% else %}
                    text-gray-600
                    {% endif %}">
                        <i class="sidebar-icon fas fa-tachometer-alt w-6 text-center text-red-500"></i>
                        <span class="sidebar-text ml-3" x-show="!sidebarCollapsed">Dashboard</span>
                    </a>
                </li>
                <li x-data="{ open: {% if request.resolver_match.url_name|in_list:"user_list,role_list,permission_type_list" %}true{% else %}false{% endif %} }" 
                    x-effect="if (sidebarCollapsed) open = false">
                    <button @click="open = !open" class="flex items-center w-full py-3 px-4 text-gray-700 hover:text-black hover:bg-gray-100 rounded-lg transition">
                        <i class="fas fa-lock w-6 text-center text-gray-500"></i>
                        <span x-show="!sidebarCollapsed" class="ml-3 flex-1 text-left">User Management</span>
                        <i x-show="!sidebarCollapsed" class="fas fa-chevron-down ml-auto text-xs transition-transform" :class="{'rotate-180': open}"></i>
                    </button>

                    <!-- Nested menu -->
                    <ul x-show="open" x-transition x-cloak class="ml-6 mt-2 space-y-1">
                        {% if can_read_user %}
                        <li>
                            <a href="{% url 'user_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition
                                {% if request.resolver_match.url_name == 'user_list' %}
                                    bg-gray-200 text-black font-semibold
                                {% else %}
                                    text-gray-600 hover:bg-gray-100
                                {% endif %}">
                                <i class="fas fa-users w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Users</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_role %}
                        <li>
                            <a href="{% url 'role_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition
                                {% if request.resolver_match.url_name == 'role_list' %}
                                    bg-gray-200 text-black font-semibold
                                {% else %}
                                    text-gray-600 hover:bg-gray-100
                                {% endif %}">
                                <i class="fas fa-user-tie w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Roles</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_permission %}
                        <li>
                            <a href="{% url 'permission_type_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition
                                {% if request.resolver_match.url_name == 'permission_type_list' %}
                                    bg-gray-200 text-black font-semibold
                                {% else %}
                                    text-gray-600 hover:bg-gray-100
                                {% endif %}">
                                <i class="fa-solid fa-user-shield w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Permissions</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </li>
                <li x-data="{ open: {% if request.resolver_match.url_name|in_list:'warehouse_list,inventory_list,stocktransaction_list,stocktransfer_list' %}true{% else %}false{% endif %} }"
                    x-effect="if (sidebarCollapsed) open = false">
                    
                    <button @click="open = !open" class="flex items-center w-full py-3 px-4 text-gray-700 hover:text-black hover:bg-gray-100 rounded-lg transition">
                        <i class="fas fa-warehouse w-6 text-center text-gray-500"></i>
                        <span x-show="!sidebarCollapsed" class="ml-3 flex-1 text-left">Warehouse</span>
                        <i x-show="!sidebarCollapsed" class="fas fa-chevron-down ml-auto text-xs transition-transform" :class="{'rotate-180': open}"></i>
                    </button>

                    <ul x-show="open" x-transition x-cloak class="ml-6 mt-2 space-y-1">

                        {% if can_read_warehouse %}
                        <li>
                            <a href="{% url 'warehouse_list' %}" class="sidebar-item flex items-center py-2 px-2 rounded-lg transition 
                                {% if request.resolver_match.url_name == 'warehouse_list' %} bg-gray-200 text-black font-semibold 
                                {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-building w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Warehouses</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_inventory %}
                        <li>
                            <a href="{% url 'inventory_list' %}" class="sidebar-item flex items-center py-2 px-2 rounded-lg transition 
                                {% if request.resolver_match.url_name == 'inventory_list' %} bg-gray-200 text-black font-semibold 
                                {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-boxes-stacked w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Inventory</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_stocktransaction %}
                        <li>
                            <a href="{% url 'stocktransaction_list' %}" class="sidebar-item flex items-center py-2 px-2 rounded-lg transition 
                                {% if request.resolver_match.url_name == 'stocktransaction_list' %} bg-gray-200 text-black font-semibold 
                                {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-exchange-alt w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Stock Transactions</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_stocktransfer %}
                        <li>
                            <a href="{% url 'stocktransfer_list' %}"
                                class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'stocktransfer_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-random w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Stock Transfers</span>
                            </a>
                        </li>
                        {% endif %}

                    </ul>
                </li>
                <li x-data="{ open: {% if request.resolver_match.url_name|in_list:'category_list,brand_list,product_list,productimage_list,productreview_list,cart_list,cartitem_list,coupon_list,order_list,orderitem_list,payment_list' %}true{% else %}false{% endif %} }" 
                    x-effect="if (sidebarCollapsed) open = false">
                    
                    <button @click="open = !open" class="flex items-center w-full py-3 px-4 text-gray-700 hover:text-black hover:bg-gray-100 rounded-lg transition">
                        <i class="fas fa-shop w-6 text-center text-gray-500"></i>
                        <span x-show="!sidebarCollapsed" class="ml-3 flex-1 text-left">E-Commerce</span>
                        <i x-show="!sidebarCollapsed" class="fas fa-chevron-down ml-auto text-xs transition-transform" :class="{'rotate-180': open}"></i>
                    </button>

                    <ul x-show="open" x-transition x-cloak class="ml-6 mt-2 space-y-1">
                        {% if can_read_category %}
                        <li>
                            <a href="{% url 'category_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'category_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-folder-open w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Categories</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_brand %}
                        <li>
                            <a href="{% url 'brand_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'brand_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-tags w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Brands</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_product %}
                        <li>
                            <a href="{% url 'product_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'product_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-box w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Products</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_productimage %}
                        <li>
                            <a href="{% url 'productimage_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'productimage_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-image w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Product Images</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_productreview %}
                        <li>
                            <a href="{% url 'productreview_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'productreview_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-star w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Product Reviews</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_cart %}
                        <li>
                            <a href="{% url 'cart_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'cart_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-shopping-cart w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Carts</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_cartitem %}
                        <li>
                            <a href="{% url 'cartitem_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'cartitem_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-shopping-bag w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Cart Items</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_coupon %}
                        <li>
                            <a href="{% url 'coupon_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'coupon_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-ticket-alt w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Coupons</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_order %}
                        <li>
                            <a href="{% url 'order_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'order_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-clipboard-list w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Orders</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_orderitem %}
                        <li>
                            <a href="{% url 'orderitem_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'orderitem_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-list-ul w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Order Items</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_payment %}
                        <li>
                            <a href="{% url 'payment_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'payment_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-credit-card w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Payments</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </li>
                <li x-data="{ open: {% if request.resolver_match.url_name|in_list:'account_list,contact_list,lead_list,opportunity_list,activity_list,opportunitynote_list,document_list' %}true{% else %}false{% endif %} }" 
                    x-effect="if (sidebarCollapsed) open = false">

                    <button @click="open = !open" class="flex items-center w-full py-3 px-4 text-gray-700 hover:text-black hover:bg-gray-100 rounded-lg transition">
                        <i class="fas fa-briefcase w-6 text-center text-gray-500"></i>
                        <span x-show="!sidebarCollapsed" class="ml-3 flex-1 text-left">CRM</span>
                        <i x-show="!sidebarCollapsed" class="fas fa-chevron-down ml-auto text-xs transition-transform" :class="{'rotate-180': open}"></i>
                    </button>

                    <ul x-show="open" x-transition x-cloak class="ml-6 mt-2 space-y-1">
                        {% if can_read_account %}
                        <li>
                            <a href="{% url 'account_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'account_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-building w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Accounts</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_contact %}
                        <li>
                            <a href="{% url 'contact_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'contact_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-address-book w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Contacts</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_lead %}
                        <li>
                            <a href="{% url 'lead_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'lead_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-user-plus w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Leads</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_opportunity %}
                        <li>
                            <a href="{% url 'opportunity_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'opportunity_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-handshake w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Opportunities</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_activity %}
                        <li>
                            <a href="{% url 'activity_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'activity_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-tasks w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Activities</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_opportunitynote %}
                        <li>
                            <a href="{% url 'opportunitynote_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'opportunitynote_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-sticky-note w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Opportunity Notes</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_document %}
                        <li>
                            <a href="{% url 'document_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'document_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-file-alt w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Documents</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </li>
                <li x-data="{ open: {% if request.resolver_match.url_name|in_list:'page_list,section_list,image_list,video_list,faq_list,banner_list,testimonial_list,metatag_list' %}true{% else %}false{% endif %} }" 
                    x-effect="if (sidebarCollapsed) open = false">

                    <button @click="open = !open" class="flex items-center w-full py-3 px-4 text-gray-700 hover:text-black hover:bg-gray-100 rounded-lg transition">
                        <i class="fas fa-layer-group w-6 text-center text-gray-500"></i>
                        <span x-show="!sidebarCollapsed" class="ml-3 flex-1 text-left">CMS</span>
                        <i x-show="!sidebarCollapsed" class="fas fa-chevron-down ml-auto text-xs transition-transform" :class="{'rotate-180': open}"></i>
                    </button>

                    <ul x-show="open" x-transition x-cloak class="ml-6 mt-2 space-y-1">
                        {% if can_read_page %}
                        <li>
                            <a href="{% url 'page_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'page_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-file-alt w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Pages</span>
                            </a>
                        </li>
                        {% endif %}
                        {% if can_read_section %}
                        <li>
                            <a href="{% url 'section_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'section_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-align-left w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Sections</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_image %}
                        <li>
                            <a href="{% url 'image_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'image_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-image w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Images</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_video %}
                        <li>
                            <a href="{% url 'video_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'video_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-video w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Videos</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_faq %}
                        <li>
                            <a href="{% url 'faq_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'faq_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-question-circle w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">FAQs</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_banner %}
                        <li>
                            <a href="{% url 'banner_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'banner_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-photo-video w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Banners</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_testimonial %}
                        <li>
                            <a href="{% url 'testimonial_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'testimonial_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-comments w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Testimonials</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if can_read_metatag %}
                        <li>
                            <a href="{% url 'metatag_list' %}" class="sidebar-item flex items-center py-2 px-1 rounded-lg transition {% if request.resolver_match.url_name == 'metatag_list' %} bg-gray-200 text-black font-semibold {% else %} text-gray-600 hover:bg-gray-100 {% endif %}">
                                <i class="fas fa-tags w-5 text-center text-gray-500"></i>
                                <span class="ml-2" x-show="!sidebarCollapsed">Meta Tags</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </li>
                {% if can_read_logs %}
                <li>
                    <a href="{% url 'audit_log_list' %}" class="sidebar-item flex items-center py-3 px-4 rounded-lg text-gray-600
                    {% if request.resolver_match.url_name == 'audit_log_list' %}
                    active shadow-lg
                    {% else %}
                    text-gray-600
                    {% endif %}">
                        <i class="sidebar-icon fa-solid fa-history text-gray-500 w-6 text-center"></i>
                        <span class="sidebar-text ml-3" x-show="!sidebarCollapsed">Audit Logs</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="main-content">
        <!-- Header -->
        <header class="header flex items-center justify-between px-6 bg-green-50 shadow">
            <!-- Mobile menu button -->
            <button id="mobile-menu-button" class="hamburger md:hidden focus:outline-none">
                <div></div>
                <div></div>
                <div></div>
            </button>
            
            <!-- Search bar -->
            <div class="hidden md:flex items-center bg-gray-100 rounded-lg px-4 py-2 flex-1 max-w-md mx-4">
                <i class="fas fa-search text-gray-500 mr-2"></i>
                <input type="text" placeholder="Search..." class="bg-transparent border-none focus:outline-none w-full">
            </div>
            
            <!-- Right side icons -->
            <div class="flex items-center space-x-4">
                <div class="relative inline-block group" id="notificationWrapper">
                    <button id="notificationBtn" class="text-gray-500 hover:text-gray-700 relative focus:outline-none">
                        <i class="fas fa-bell text-xl"></i>
                        <span id="notificationCount" class="notification-badge absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1.5 hidden">0</span>
                    </button>

                    {% if can_read_notification %}
                    <div id="notificationDropdown"
                        class="hidden group-hover:block absolute right-0 mt-2 w-80 bg-white border rounded shadow-md z-50 transition">
                        <div id="notificationList" class="p-2 max-h-64 overflow-y-auto"></div>
                    </div>
                    {% endif %}
                </div>

                
                <!-- Profile dropdown -->
                <div class="profile-toggle relative">
                    <button class="flex items-center focus:outline-none">
                        <img src="{{ request.user.profile.image.url|default:'https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg' }}" alt="Profile" class="w-8 h-8 rounded-full border-2 border-white">
                        <span class="ml-2 text-gray-700 hidden md:inline">{{ request.user.full_name|default:request.user.email }}</span>
                        <i class="fas fa-chevron-down text-xs ml-1 text-gray-500 hidden md:inline"></i>
                    </button>
                    
                    <div class="profile-menu mt-2 py-2">
                        {% if can_update_profile%}
                        <a href="{% url 'profile' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                            <i class="fas fa-user mr-2"></i> Profile
                        </a>
                        {% endif %}
                        
                        {% if can_password_change_user%}
                        <a href="#" id="openChangePasswordModal" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                            <i class="fas fa-cog mr-2"></i> Settings
                        </a>
                        {% endif %}
                        <a href="{% url 'logout' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                            <i class="fas fa-sign-out-alt mr-2"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </header>
{% if messages %}
  <div id="notification" class="fixed top-20 right-6 px-4 py-2 rounded shadow-md z-50 hidden transition-all duration-500 ease-in-out opacity-0">
    {% for message in messages %}
      <span id="notification-text" data-level="{{ message.tags }}">{{ message }}</span>
    {% endfor %}
  </div>
{% endif %}

{% block content %}
        <!-- Page content -->
        <main class="p-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-6">𝙳𝚊𝚜𝚑𝚋𝚘𝚊𝚛𝚍 𝙾𝚟𝚎𝚛𝚟𝚒𝚎𝚠</h1>
            <!-- Your Django template content would go here -->
            <div class="bg-white rounded-lg shadow p-6">
                <p class="text-gray-600">Welcome to your Django admin dashboard. This is where your main content will appear.</p>
            </div>
        </main>
    </div>
{% endblock %}

    <!-- Change Password Modal -->
    <div id="ChangePasswordModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center">
        <div class="modal-content bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Create New Password</h3>
                <button id="closeChangePasswordModal" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form method="POST" action="{% url 'change_password' %}">
                {% csrf_token %}
                <div class="mb-4">
                    <label for="oldPassword" class="block text-sm font-medium text-gray-700">Old Password</label>
                    <input type="password" name="old_password" id="roleName" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div class="mb-4">
                    <label for="newPassword" class="block text-sm font-medium text-gray-700">New Password</label>
                    <input type="password" name="new_password1" id="roleName" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div class="mb-4">
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-700">Confirm Password</label>
                    <input type="password" name="new_password2" id="roleName" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div class="flex justify-end gap-3">
                    <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 text-sm">Change Password</button>
                    <button type="button" id="cancelChangePassword" class="bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-md hover:bg-gray-100 text-sm">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Role Scripts -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const modal = document.getElementById("ChangePasswordModal");
            const openBtn = document.getElementById("openChangePasswordModal");
            const closeBtn = document.getElementById("closeChangePasswordModal");
            const cancelBtn = document.getElementById("cancelChangePassword");

            openBtn?.addEventListener("click", () => {
                modal.classList.remove("hidden");
                modal.classList.add("flex");
            });

            closeBtn?.addEventListener("click", () => {
                modal.classList.add("hidden");
                modal.classList.remove("flex");
            });

            cancelBtn?.addEventListener("click", () => {
                modal.classList.add("hidden");
                modal.classList.remove("flex");
            });

            window.addEventListener("click", (e) => {
                if (e.target === modal) {
                    modal.classList.add("hidden");
                    modal.classList.remove("flex");
                }
            });
        });
    </script>

    <!--  Toggle sidebar collapse/expand -->
    <script>
        // Toggle sidebar collapse/expand
        const toggleSidebar = document.getElementById('toggle-sidebar');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        
        toggleSidebar.addEventListener('click', () => {
            sidebar.classList.toggle('sidebar-collapsed');
            mainContent.classList.toggle('main-content-expand');
            
            // Change the icon based on state
            const icon = toggleSidebar.querySelector('i');
            if (sidebar.classList.contains('sidebar-collapsed')) {
                icon.classList.remove('fa-chevron-left');
                icon.classList.add('fa-chevron-right');
            } else {
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-left');
            }
        });

        // Mobile menu toggle
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        mobileMenuButton.addEventListener('click', () => {
            sidebar.classList.toggle('sidebar-open');
            mobileMenuButton.classList.toggle('hamburger-active');
        });

        // Close mobile menu when clicking on a nav item
        const navItems = document.querySelectorAll('.sidebar-item');
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                if (window.innerWidth < 768) {
                    sidebar.classList.remove('sidebar-open');
                    mobileMenuButton.classList.remove('hamburger-active');
                }
            });
        });
    </script>

    <!-- Set background color based on message level -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
        const notification = document.getElementById('notification');
        const textEl = document.getElementById('notification-text');

        if (notification && textEl) {
            const level = textEl.dataset.level; // success, error, warning, info
            const message = textEl.textContent;

            // Set background color based on message level
            notification.classList.remove('bg-green-500', 'bg-red-500', 'bg-yellow-500', 'bg-blue-500');

            switch (level) {
                case 'success':
                    notification.classList.add('bg-green-500');
                    break;
                case 'error':
                    notification.classList.add('bg-red-500');
                    break;
                case 'warning':
                    notification.classList.add('bg-yellow-500', 'text-black');
                    break;
                case 'info':
                    notification.classList.add('bg-blue-500');
                    break;
                default:
                    notification.classList.add('bg-gray-800');
            }

            // Show notification
            notification.classList.remove('hidden', 'opacity-0');
            notification.classList.add('opacity-100');

            // Hide after 3 seconds
            setTimeout(() => {
                notification.classList.remove('opacity-100');
                notification.classList.add('opacity-0');
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 500); // match the transition duration
            }, 3000);
        }
        });
    </script>

    <!-- Send real time to the server -->
    <input type="hidden" id="clientTime" name="client_time">
    <script>
        function getISOTimeNow() {
            const now = new Date();
            const offset = now.getTimezoneOffset();
            const localTime = new Date(now.getTime() - offset * 60000);
            return localTime.toISOString().slice(0, 19);
        }
        document.addEventListener('DOMContentLoaded', function () {
            const input = document.getElementById('clientTime');
            if (input) {
                const now = getISOTimeNow();
                input.value = now;
            }
        });
    </script>

    <!-- Show the notification -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const btn = document.getElementById('notificationBtn');
            const dropdown = document.getElementById('notificationDropdown');
            const list = document.getElementById('notificationList');
            const count = document.getElementById('notificationCount');
            const wrapper = document.getElementById('notificationWrapper');

            // CSRF token helper
            function getCSRFToken() {
                return document.cookie.split('; ')
                    .find(row => row.startsWith('csrftoken='))
                    ?.split('=')[1];
            }

            function fetchNotifications() {
                fetch('/get-notifications/')
                    .then(response => response.json())
                    .then(data => {
                        if (data.count > 0) {
                            count.textContent = data.count;
                            count.classList.remove('hidden');
                            list.innerHTML = '';
                            data.notifications.forEach(notif => {
                                list.innerHTML += `
                                    <div class="notification-wrapper flex items-center justify-between gap-3 p-2 border-b transition-opacity duration-300">
                                        <div class="flex items-center gap-3 cursor-pointer">
                                        <img src="${notif.avatar}" class="w-8 h-8 rounded-full" alt="Avatar">
                                        <div class="notification-item">
                                            <p class="text-sm font-semibold">${notif.user}</p>
                                            <p class="text-xs text-gray-500">${notif.timestamp}</p>
                                        </div>
                                        </div>
                                        <button class="delete-notification text-gray-400 hover:text-red-600 text-lg"
                                                data-notification-id="${notif.notif_id}">
                                        &times;
                                        </button>
                                    </div>
                                `;
                            });
                        } else {
                            count.classList.add('hidden');
                            list.innerHTML = `<p class="text-center text-gray-500 text-sm py-4">No new notifications</p>`;
                        }
                    });
            }

            list.addEventListener('click', function (e) {
                const deleteBtn = e.target.closest('.delete-notification');

                if (deleteBtn) {
                    const notifId = deleteBtn.dataset.notificationId;

                    fetch(`/notifications/delete/${notifId}/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': getCSRFToken(),
                            'Content-Type': 'application/json'
                        }
                    }).then(() => {
                        const notifElement = deleteBtn.closest('.notification-wrapper');
                        notifElement.classList.add('opacity-0');
                        setTimeout(() => notifElement.remove(), 300);
                        fetchNotifications();
                    });
                    return;
                }
            });

            // Toggle dropdown on bell click
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdown.classList.toggle('hidden');
                if (!dropdown.classList.contains('hidden')) {
                    fetchNotifications();
                }
            });

            // Hide dropdown when clicking outside
            document.addEventListener('click', function (e) {
                if (!wrapper.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
            fetchNotifications();
            // Refresh every 30 seconds (you can adjust this to 10s or 30s)
            setInterval(fetchNotifications, 60000);
        });
    </script>


</body>
</html>
